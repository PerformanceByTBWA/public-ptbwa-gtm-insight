___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.

___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "displayName": "Ptbwa",
  "description": "Ptbwa Pixel helps you capture rich behavioral signals and key conversion events 
  from your website visitors, enabling smarter audience segmentation and optimization.",
  "containerContexts": ["WEB"],
  "categories": ["ATTRIBUTION", "ANALYTICS", "REMARKETING", "PERSONALIZATION"],
  "securityGroups": [],
  "brand": {
    "id": "brand_dummy",
    "displayName": "Ptbwa",
    "thumbnail": "data:image/png;base64,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UmVhZHlxyWU8AAADJ2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDEgNzkuMTQ2Mjg5OTc3NywgMjAyMy8wNi8yNS0yMzo1NzoxNCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDI0LjcgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkYyRkU3Rjk2NTc3MjExRUVCQ0FDOUM0MTBCNjk5NUE0IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkYyRkU3Rjk3NTc3MjExRUVCQ0FDOUM0MTBCNjk5NUE0Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RjJGRTdGOTQ1NzcyMTFFRUJDQUM5QzQxMEI2OTk1QTQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RjJGRTdGOTU1NzcyMTFFRUJDQUM5QzQxMEI2OTk1QTQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6KhdQdAAAax0lEQVR42uxdB1gUV9c+s7v0jogNxd4VRETAggj2hg1jiRoTyx9bTD41RhNNM4km0Rh7YjcaNSoqIigI2LGiggUVCxaU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"
  }
}

___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const getUrl = require('getUrl');
const getReferrerUrl = require('getReferrerUrl');
const getCookieValues = require('getCookieValues');
const setCookie = require('setCookie');
const generateRandom = require('generateRandom');
const getTimestampMillis = require('getTimestampMillis');
const sendPixel = require('sendPixel');
const encodeUriComponent = require('encodeUriComponent');
const JSON = require('JSON');

const COOKIE_NAME = '_insight_uid';
const GA_COOKIE = '_ga';
const PIXEL_ENDPOINT = 'https://yourdomain.com/insight-pixel';


function createUuid() {
  const hex = '0123456789abcdef';
  const sections = [8, 4, 4, 4, 12];
  let uuid = '';
  for (let i = 0; i < sections.length; i++) {
    if (i > 0) uuid += '-';
    for (let j = 0; j < sections[i]; j++) {
      uuid += hex.charAt(Math.floor(generateRandom(0, 16)));
    }
  }
  return uuid;
}


function getOrCreateUid(cookieName) {
  let uid = getCookieValues(cookieName)[0];
  if (!uid) uid = createUuid();
  setCookie(cookieName, uid, {
    'max-age': 60 * 60 * 24 * 30, // 30ì¼
    'secure': true
  });
  return uid;
}


function serialize(params) {
  return Object.keys(params)
    .map(key => key + '=' + encodeUriComponent(params[key] || ''))
    .join('&');
}


(function () {
  const userId = getOrCreateUid(COOKIE_NAME);
  const gaId = getCookieValues(GA_COOKIE)[0] || '';
  const timestamp = getTimestampMillis();

  const payload = {
    pid: data.pixelId,
    eid: createUuid(),
    ev: data.eventType,
    scroll: data.scrollDepth,
    time: data.timeOnPage,
    click: data.clickedId,
    conv_type: data.conversionType,
    conv_value: data.conversionValue,
    conv_meta: data.conversionMeta ? JSON.stringify(data.conversionMeta) : '',
    cid: userId,
    gid: gaId,
    url: getUrl(),
    ref: getReferrerUrl(),
    ts: timestamp
  };

  const pixelUrl = PIXEL_ENDPOINT + '?' + serialize(payload);

  sendPixel(pixelUrl, data.gtmOnSuccess, data.gtmOnFailure);
})();


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "pixelId",
    "displayName": "Pixel ID",
    "simpleValueType": true,
    "valueValidators": [
      { "type": "NON_EMPTY" }
    ]
  },
  {
    "type": "TEXT",
    "name": "eventType",
    "displayName": "Event Type",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "scrollDepth",
    "displayName": "Scroll Depth (%)",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "timeOnPage",
    "displayName": "Time on Page (ms)",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "clickedId",
    "displayName": "Clicked Element ID or Class",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "conversionType",
    "displayName": "Conversion Type (lead, purchase, etc.)",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "conversionValue",
    "displayName": "Conversion Value (USD)",
    "simpleValueType": true,
    "valueValidators": [
      { "type": "NON_NEGATIVE_NUMBER" }
    ]
  },
  {
    "type": "TEXT",
    "name": "conversionMeta",
    "displayName": "Conversion Metadata (optional JSON)",
    "simpleValueType": true
  }
]

___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": { "publicId": "send_pixel", "versionId": "1" },
      "param": [
        { "key": "allowedUrls", "value": { "type": 1, "string": "specific" } },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              { "type": 1, "string": "https://yourdomain.com/*" }
            ]
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": { "publicId": "get_cookies", "versionId": "1" },
      "param": [
        { "key": "cookieAccess", "value": { "type": 1, "string": "specific" } },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              { "type": 1, "string": "_insight_uid" },
              { "type": 1, "string": "_ga" }
            ]
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": { "publicId": "set_cookies", "versionId": "1" },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  { "type": 1, "string": "name" },
                  { "type": 1, "string": "domain" },
                  { "type": 1, "string": "path" },
                  { "type": 1, "string": "secure" },
                  { "type": 1, "string": "session" }
                ],
                "mapValue": [
                  { "type": 1, "string": "_insight_uid" },
                  { "type": 1, "string": "*" },
                  { "type": 1, "string": "*" },
                  { "type": 1, "string": "secure" },
                  { "type": 1, "string": "any" }
                ]
              }
            ]
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": { "publicId": "get_url", "versionId": "1" },
      "param": [
        { "key": "urlParts", "value": { "type": 1, "string": "any" } },
        { "key": "queriesAllowed", "value": { "type": 1, "string": "any" } }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": { "publicId": "get_referrer", "versionId": "1" },
      "param": [
        { "key": "urlParts", "value": { "type": 1, "string": "any" } },
        { "key": "queriesAllowed", "value": { "type": 1, "string": "any" } }
      ]
    },
    "isRequired": true
  }
]

___TESTS___ 

scenarios:
  - name: PageView pixel fires correctly
    code: |-
      const mockUrl = [];
      mock('sendPixel', function(url, success, fail) {
        mockUrl.push(url);
        if (success) success();
      });
      mock('getCookieValues', () => ['uuid-123']);
      mock('getUrl', () => 'https://example.com/page');
      mock('getReferrerUrl', () => 'https://referrer.com');
      mock('getTimestampMillis', () => 1234567890);
      mock('generateRandom', () => 1);

      runCode({
        pixelId: 'abc123',
        eventType: 'page_view'
      });

      assertApi('sendPixel').wasCalled();
      assertApi('gtmOnSuccess').wasCalled();
      assertThat(mockUrl[0]).contains('ev=page_view');
      assertThat(mockUrl[0]).contains('pid=abc123');

  - name: Conversion event is serialized and sent
    code: |-
      const mockUrl = [];
      mock('sendPixel', function(url, success, fail) {
        mockUrl.push(url);
        if (success) success();
      });
      mock('getCookieValues', () => ['uuid-abc']);
      mock('getUrl', () => 'https://example.com/thankyou');
      mock('getReferrerUrl', () => 'https://ad.com');
      mock('getTimestampMillis', () => 999999999);
      mock('generateRandom', () => 1);

      runCode({
        pixelId: 'abc123',
        eventType: 'purchase',
        conversionType: 'purchase',
        conversionValue: '49.99',
        conversionMeta: '{"coupon":"NEW50"}'
      });

      assertApi('sendPixel').wasCalled();
      assertApi('gtmOnSuccess').wasCalled();
      assertThat(mockUrl[0]).contains('conv_type=purchase');
      assertThat(mockUrl[0]).contains('conv_value=49.99');
      assertThat(mockUrl[0]).contains('conv_meta=%7B%22coupon%22%3A%22NEW50%22%7D');

  - name: Cookie is set when not exists
    code: |-
      mock('getCookieValues', () => []);
      mock('setCookie', () => {});
      mock('sendPixel', (url, s, f) => s && s());
      mock('getUrl', () => 'https://test.com');
      mock('getReferrerUrl', () => '');
      mock('getTimestampMillis', () => 1234);
      mock('generateRandom', () => 1);

      runCode({
        pixelId: 'abc123',
        eventType: 'scroll',
        scrollDepth: '80'
      });

      assertApi('setCookie').wasCalled();
      assertApi('sendPixel').wasCalled();
      assertApi('gtmOnSuccess').wasCalled();

  - name: gtmOnFailure is triggered on send error
    code: |-
      mock('sendPixel', function(url, success, fail) {
        if (fail) fail();
      });

      runCode({
        pixelId: 'fail123',
        eventType: 'click'
      });

      assertApi('gtmOnFailure').wasCalled();

